sudo: required

env: 
  - TRAVIS_TAG=continuous

matrix:
  include:
    - env: ARCH=armhf
    - env: ARCH=arm64
    - env: ARCH=amd64
    - env: ARCH=i386

install:
  - echo "deb http://de.archive.ubuntu.com/ubuntu xenial main universe" |sudo tee -a /etc/apt/sources.list
  - sudo apt-get update
  - sudo apt-get install qemu-user-static debootstrap -y

script:
  - sudo ./build-initrd.sh

before_cache:
  - sudo chown -R travis build/

cache:
  directories:
    - build/

before_deploy:
    # Set up git user name and tag this commit
  - git config --local user.name "halium-initramfs-bot"
  - git config --local user.email "halium-initramfs-bot@users.noreply.github.com"
  - git tag -fa "continuous" -m "Generated by Travis-CI"
  - export TRAVIS_TAG='continuous'

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: "HDNL72CY4slJoKUehG+bVT/qo/Fi+R5C5bpfIH9oBQB9B5HOTVzUlG91tQXPBV7lMe0/LdtR4xJWqkltXn7hI39EnEdBA+xbnM3l8RNv6mK1/+zxCIO2C6f8C1LFImHW9BwLBrdr/wC/4ccab7m4VHWgYLke6E8UhaLMkQeDbmVS84ssAZOEHpgJwx7BWFY6MN98Ia2q+lhAu9uftfcxRTdnEYXwrpU7SHdCCb7HYmEsqfqjxhSnluxCn4rUOc2oaq6cW3VM7pj3UdnImwzurgcb9NDlAw7mTntTj5mG9iM75EL0sLrRmUMUfiHz2lukkZNuc48/USxD+C/Zy8YuMIAjve9P+Wqp5wqE2A028GlKQner5WItHpM9mCG1pFUXpaNan/bwye7S7JNNeU3Foj2R4j3Ts9NqGjGFMHVvAdrvuy35t0ZmrBXw2BPEFQoBuOU957d4FIFCl4mg7X40lEn30/QT6F8U4oNIJWxMv9+XMWJl+V1SmxjMSMi+amIviHL4mwrIQafwzT38k+6PxgfIwGfGIoKLnJJEiwUSX3yoffAKRtM6W5M2dqPnIfxPvzibHWgWLrjzWN7tGhTYWXh9OJNk3Kp913x+W7HC1+ZWi+5aRXNMutxj4c1QQt3qkJMqAfFimiRhiwy78upy+Nt4viKk/gELYlU2F3YkXqA="
  file: 
    - out/initrd.img-touch-armhf
    - out/initrd.img-touch-arm64
    - out/initrd.img-touch-amd64
    - out/initrd.img-touch-i386
  on:
    repo: Halium/initramfs-tools-halium
    branch: halium
  overwrite: true
